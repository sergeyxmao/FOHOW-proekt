:root{
  --card-width: 380px;
  --brand: #0f62fe;
  --ink: #111827;
  --muted: #6b7280;
  --panel: #ffffff;
  --surface: #ffffff;
  --bg: #f5f7fb;
  --radius: 14px;
  --shadow: 0 8px 20px rgba(0,0,0,.12);
}

html,body{
  margin:0; padding:0; width:100%; height:100%;
  overflow:hidden;
  background: var(--bg);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: var(--ink);
  user-select: none;
}

/* Панели */
.ui-panel-left{
  position:fixed; top:20px; left:20px; z-index:2000;
  display:flex; align-items:center; gap:10px;
  background: var(--panel);
  padding:8px 10px; border-radius: var(--radius); box-shadow: var(--shadow);
}
.ui-panel-right{
  position:fixed; top:20px; right:20px; z-index:2000;
  display:flex; flex-direction:column; align-items:flex-end; gap:14px;
}
.ui-panel-right .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }

.ui-btn{
  min-width:40px; height:40px; padding:0 10px;
  background:#fff; border:1px solid #e5e7eb; border-radius:10px;
  font-size:18px; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.06);
  transition:transform .15s, box-shadow .15s, background-color .15s, border-color .15s;
  display:grid; place-items:center; color:var(--ink);
}
.ui-btn:hover{ transform:translateY(-1px); box-shadow:0 6px 14px rgba(0,0,0,.12); border-color:#d1d5db; }
.ui-btn.active{ background:#eaf1ff; border-color:#cfe0ff; color:#0b5bd3; }
.ui-btn:disabled{ opacity:.45; cursor:not-allowed; }

/* Кнопки + и ▶ в едином стиле */
.add-btn{
  width:56px; height:56px;
  background:#fff; color:var(--brand);
  border:1px solid #e5e7eb; border-radius:12px;
  font-size:28px; font-weight:700; cursor:pointer; box-shadow: var(--shadow);
  transition:transform .15s, box-shadow .15s, border-color .15s;
  display:grid; place-items:center;
}
.add-btn:hover{ transform:translateY(-1px); box-shadow:0 10px 22px rgba(0,0,0,.14); border-color:#cfe0ff; }
.add-btn--triangle{ color:#111; font-size:24px; }
.add-btn--large{ font-size: 32px; font-weight: 500; line-height: 1; padding-bottom: 4px; }

/* Обновленная панель управления линиями */
.line-controls-panel{
  display:flex; gap:12px; align-items:center;
  background:#fff; padding:10px 14px; border-radius:12px; box-shadow: var(--shadow);
  min-width:240px;
}
.line-color-trigger{
  width:28px; height:28px; border-radius:50%;
  border:2px solid #9ca3af; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,.1);
  transition: transform .15s;
}
.line-color-trigger:hover{ transform: scale(1.1); }
.line-controls-col{ text-align:center; }
.line-controls-col label{ font-size:13px; font-weight:700; margin-bottom:8px; display:block; color:#374151; }
.apply-all-btn{
  width:32px; height:32px; padding:0; border-radius:8px;
  background:#fff; border:1px solid #d1d5db; color: #6b7280;
  cursor:pointer; display:grid; place-items:center; transition: .2s;
}
.apply-all-btn:hover{ border-color: #9ca3af; background: #f9fafb; }
.apply-all-btn.active{ background: #eaf1ff; border-color: #0f62fe; color: #0f62fe; }

/* Слайдеры */
.thickness-slider{
  appearance:none; width:120px; height:8px; border-radius:999px;
  background:linear-gradient(90deg, var(--brand) 0%, var(--brand) 0%, #e5e7eb 0%); outline:none;
}
.thickness-slider::-webkit-slider-thumb{
  appearance:none; width:20px; height:20px; border-radius:50%; background:var(--brand);
  box-shadow:0 3px 8px rgba(0,0,0,.2); cursor:pointer; transition:transform .15s;
}
.thickness-slider::-webkit-slider-thumb:hover{ transform:scale(1.1); }
#thickness-value{ font-variant-numeric: tabular-nums; }

/* Фон */
.gradient-selector{
  display:grid; grid-template-columns: repeat(3, 45px); gap:8px;
  background:#fff; padding:10px 12px; border-radius:12px; box-shadow: var(--shadow); justify-items:center; align-items:center;
}
.gradient-title{ grid-column:1/-1; font-size:13px; font-weight:700; margin-bottom:2px; color:#374151; }
.grad-btn{
  width:36px; height:36px; border-radius:10px; border:1px solid #e5e7eb;
  cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.06); transition:transform .15s; background:#fff;
}
.grad-btn:hover{ transform:translateY(-1px); }

/* Canvas/SVG */
#canvas{ position:relative; width:100%; height:100%; transform-origin:0 0; cursor:default; }
#svg-layer{ position:absolute; inset:0; pointer-events:none; overflow:visible; }
.line{
  fill:none; pointer-events:auto; cursor:pointer;
  color: var(--line-color, var(--brand));
  filter: drop-shadow(0 0 5px rgba(0,0,0,.15));
  marker-start: url(#marker-dot);
  marker-end: url(#marker-dot);
}
.line.selected{ stroke-dasharray:6 6; }

/* Карточка */
.card{
  position:absolute; width:var(--card-width);
  background: var(--surface); border-radius:16px; box-shadow: var(--shadow);
  transition: transform .15s ease, box-shadow .15s ease;
}
.card:hover{ transform:translateY(-1px); box-shadow:0 12px 26px rgba(0,0,0,.18); }
.card.selected{ 
  box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.6), 0 12px 26px rgba(0,0,0,.18);
}

/* Заголовок карточки */
.card-header{
  background: var(--brand); color:#fff; padding:10px; position:relative;
  height:52px; border-radius:16px 16px 0 0; cursor:grab;
  display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:6px;
}
.card-title{
  grid-column:2/3; text-align:center; font-size:20px; line-height:1; font-weight:800; letter-spacing:.3px; outline:none;
}
.close-btn{ grid-column:3/4; justify-self:end; font-size:20px; cursor:pointer; transition:transform .15s; padding: 0 5px;}
.close-btn:hover{ transform:scale(1.1) rotate(8deg); }

/* Кнопка цвета шапки */
.header-color-picker-btn{
  position:absolute; top:80px; left:10px; z-index:10; width:22px; height:22px; border-radius:6px;
  border:2px solid #444; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,.1);
}
.header-color-picker-btn:hover{ transform:scale(1.05); }

.color-changer {
  border: 2px solid #444;
  position: absolute;
  top: 110px;
  left: 10px;
  z-index: 10;
}

/* Тело карточки */
.card-body{ padding:15px; text-align:center; background:#fff; border-radius:0 0 16px 16px; }
.card-body.dark-bg{ background:#2b2b2b; }

.card-row{ display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:12px; }
.label{ font-weight:700; color:#374151; }
.value{
  color:#111827; font-weight:800; font-size:20px; outline:none; padding:3px 6px; border-radius:5px;
}
.value:focus{ background:#fff8dc; box-shadow:0 0 6px 2px rgba(255,193,7,.35); }

/* Монетка */
.coin-icon{ width:28px; height:28px; cursor:pointer; transition:transform .15s; }
.coin-icon:hover{ transform:scale(1.1); }

/* Точки соединения */
.connection-point{
  position:absolute; width:16px; height:16px; z-index:101;
  background:#fff; border:3px solid var(--brand); border-radius:50%;
  cursor:pointer; transform:translate(-50%,-50%); display:none; transition: background .15s, transform .15s;
}
.card:hover .connection-point{ display:block; }
.connection-point:hover{ background: var(--brand); transform: scale(1.15) translate(-50%,-50%); }
.connection-point.top{ top:0; left:50%; }
.connection-point.bottom{ top:100%; left:50%; }
.connection-point.left{ top:50%; left:0; }
.connection-point.right{ top:50%; left:100%; }

/* Низ карточки */
.card-controls{ position:absolute; bottom:8px; right:8px; display:flex; gap:6px; z-index:102; }
.card-control-btn{
  width:22px; height:22px; border:none; border-radius:6px; cursor:pointer;
  box-shadow:0 2px 5px rgba(0,0,0,.1); font-size:16px; display:grid; place-items:center;
}
.body-color-changer{ position:absolute; bottom:8px; left:8px; }

/* === Стили для заметок === */
.note-btn { background:#fff; }
.note-btn.has-text { background:#e11d48; color:#fff; }
.note-window{
  position:fixed; width:260px; min-height:380px;
  background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow: var(--shadow);
  z-index:1500; 
  display:flex; flex-direction:column;
  resize:both; 
  overflow:hidden;
}
.note-header{ 
  background:#f3f4f6; padding:6px 8px; border-radius:12px 12px 0 0; cursor:grab;
  display:flex; align-items:center; justify-content:space-between;
  flex-shrink: 0;
}
.note-content-scroller { flex-grow: 1; overflow-y: auto; }
.note-textarea{
  display: block; width: calc(100% - 16px); box-sizing: border-box;
  border:1px solid #e5e7eb; background:#ffffff; color:#222; border-radius:8px; margin:8px; padding:10px;
  font-family:inherit; font-size:14px; line-height:1.35; 
  resize:vertical; outline:none; min-height:120px;
}
.note-resize-handle{ 
  position:absolute; bottom:0; right:0; width:15px; height:15px; cursor:se-resize; z-index: 1;
  background:repeating-linear-gradient(135deg,#ccc,#ccc 2px,transparent 2px,transparent 4px); 
}
.notes-dropdown{
  position:fixed; z-index:3000; display:none; max-height:320px; overflow:auto;
  min-width:280px; max-width:380px; padding:6px;
  background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow: var(--shadow);
}
.note-item{ display:flex; gap:10px; padding:8px; border-radius:10px; align-items:flex-start; justify-content:space-between; }
.note-item:hover{ background:#f3f4f6; }
.note-item-content{ display:flex; gap:10px; align-items:flex-start; cursor:pointer; flex-grow:1; }
.note-dot{ width:10px; height:10px; border-radius:50%; border:2px solid #111; margin-top:6px; flex-shrink:0; }
.note-meta{ display:flex; flex-direction:column; gap:2px; }
.note-date{ font-weight:700; }
.note-text-preview{ font-size:13px; color:var(--muted); word-break: break-word; }
.note-delete-btn{
  font-size:20px; color:#9ca3af; cursor:pointer; padding:0 4px; border-radius:50%;
  transition: color .2s, background-color .2s; flex-shrink:0; align-self:center; border: none; background: transparent;
}
.note-delete-btn:hover{ color:#ef4444; background-color:#fee2e2; }
.note-window .cal-grid{ width:100%; display:grid; grid-template-columns:repeat(7,1fr); grid-auto-rows:26px; }
.note-window .cal-cell{ min-width:0; height:26px; line-height:26px; padding:0; overflow:hidden; white-space:nowrap; text-overflow:clip; }
.note-window .cal-month{ white-space:nowrap; }

.selection-box{
  position:absolute; border:2px dashed #0f62fe; background:rgba(15,98,254,.08); pointer-events:none;
}

/* --- Стили для значков, контекстного меню и темной темы --- */
.slf-badge, .fendou-badge, .rank-badge {
  position: absolute;
  display: none;
  user-select: none;
  pointer-events: none; /* Чтобы не мешали кликам */
}
.slf-badge.visible, .fendou-badge.visible, .rank-badge.visible {
  display: block;
}
.slf-badge {
  top: 15px;
  left: 15px;
  color: #ffc700;
  font-weight: 900;
  font-size: 24px;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}
.fendou-badge {
  top: -25px;
  left: 50%;
  transform: translateX(-50%);
  color: red;
  font-weight: 900;
  font-size: 36px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}
.rank-badge {
  top: -15px;
  right: 15px;
  width: 80px;
  height: auto;
  transform: rotate(15deg);
}

.card-context-menu {
  position: fixed;
  z-index: 10000;
  display: none;
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  padding: 5px 0;
  min-width: 180px;
}
.context-menu-section {
  border-bottom: 1px solid #eee;
  padding: 5px 0;
}
.context-menu-section:last-child {
  border-bottom: none;
  padding-bottom: 0;
}
.context-menu-section:first-child {
  padding-top: 0;
}
.context-menu-item {
  padding: 8px 15px;
  cursor: pointer;
  font-size: 14px;
}
.context-menu-item:hover {
  background-color: #f0f0f0;
}
.context-menu-item.active {
  background-color: #e0eafc;
  font-weight: bold;
}

.card.dark-mode,
.card.dark-mode .card-body{ background:#2b2b2b; }
.card.dark-mode .label{ color:#e5e7eb; }
.card.dark-mode .value{ color:#f9fafb; }
.card.dark-mode .card-header{ background:#1f2937 !important; }
.card.dark-mode .card-title{ color:#f3f4f6; }
.card.dark-mode .note-btn,
.card.dark-mode .color-changer{ background:#374151 !important; border-color:#4b5563; color:#e5e7eb; }

.card.dark-mode .header-color-picker-btn,
.card.dark-mode .color-changer {
  visibility: hidden;
}
.card.dark-mode .coin-icon {
  visibility: hidden;
}

.content-hidden .slf-badge,
.content-hidden .fendou-badge,
.content-hidden .rank-badge {
  visibility: hidden !important;
}

.num-color-pop{
  position:fixed; z-index:3000; display:none; background:#fff; border:1px solid #e5e7eb; border-radius:10px;
  box-shadow: var(--shadow); padding:6px; gap:6px; align-items:center;
}
.num-color-pop .dot{ width:18px; height:18px; border-radius:50%; border:2px solid #333; cursor:pointer; }
.num-color-pop .dot.red{ background:#e53935; }
.num-color-pop .dot.yellow{ background:#ffeb3b; }
.num-color-pop .dot.green{ background:#43a047; }
.value [data-num-color]{ color: initial; }

.active-pv-controls{display:flex;justify-content:space-between;gap:8px;margin-top:4px}
.active-pv-controls .left-controls,
.active-pv-controls .right-controls{display:flex;gap:6px}
.active-pv-controls .mid-controls{display:flex;align-items:center}
.active-btn{font-size:12px;padding:2px 6px;border-radius:8px;border:1px solid rgba(0,0,0,.12);background:#f5f5f7;cursor:pointer}
.card.dark-mode .active-btn{background:#2b2b2f;border-color:#3a3a40}
.active-btn:hover{filter:brightness(.96)}
.card .active-pv-row .value{pointer-events:none; user-select:none;}

.guide-line {
  position: fixed;
  background-color: rgba(255, 0, 0, 0.7);
  z-index: 9998;
  display: none;
  pointer-events: none;
  box-shadow: 0 0 3px rgba(0,0,0,0.5);
}
.guide-line.vertical {
  width: 1px;
  height: 100vh;
  top: 0;
}
.guide-line.horizontal {
  height: 1px;
  width: 100vw;
  left: 0;
}
#toggle-guides-btn.active {
    background-color: #eaf1ff;
    color: #0f62fe;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
}:root{
  --card-width: 380px;
  --brand: #0f62fe;
  --ink: #111827;
  --muted: #6b7280;
  --panel: #ffffff;
  --surface: #ffffff;
  --bg: #f5f7fb;
  --radius: 14px;
  --shadow: 0 8px 20px rgba(0,0,0,.12);
}

html,body{
  margin:0; padding:0; width:100%; height:100%;
  overflow:hidden;
  background: var(--bg);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: var(--ink);
  user-select: none;
}

/* Панели */
.ui-panel-left{
  position:fixed; top:20px; left:20px; z-index:2000;
  display:flex; align-items:center; gap:10px;
  background: var(--panel);
  padding:8px 10px; border-radius: var(--radius); box-shadow: var(--shadow);
}
.ui-panel-right{
  position:fixed; top:20px; right:20px; z-index:2000;
  display:flex; flex-direction:column; align-items:flex-end; gap:14px;
}
.ui-panel-right .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }

.ui-btn{
  min-width:40px; height:40px; padding:0 10px;
  background:#fff; border:1px solid #e5e7eb; border-radius:10px;
  font-size:18px; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.06);
  transition:transform .15s, box-shadow .15s, background-color .15s, border-color .15s;
  display:grid; place-items:center; color:var(--ink);
}
.ui-btn:hover{ transform:translateY(-1px); box-shadow:0 6px 14px rgba(0,0,0,.12); border-color:#d1d5db; }
.ui-btn.active{ background:#eaf1ff; border-color:#cfe0ff; color:#0b5bd3; }
.ui-btn:disabled{ opacity:.45; cursor:not-allowed; }

/* Кнопки + и ▶ в едином стиле */
.add-btn{
  width:56px; height:56px;
  background:#fff; color:var(--brand);
  border:1px solid #e5e7eb; border-radius:12px;
  font-size:28px; font-weight:700; cursor:pointer; box-shadow: var(--shadow);
  transition:transform .15s, box-shadow .15s, border-color .15s;
  display:grid; place-items:center;
}
.add-btn:hover{ transform:translateY(-1px); box-shadow:0 10px 22px rgba(0,0,0,.14); border-color:#cfe0ff; }
.add-btn--triangle{ color:#111; font-size:24px; }
.add-btn--large{ font-size: 32px; font-weight: 500; line-height: 1; padding-bottom: 4px; }

/* Обновленная панель управления линиями */
.line-controls-panel{
  display:flex; gap:12px; align-items:center;
  background:#fff; padding:10px 14px; border-radius:12px; box-shadow: var(--shadow);
  min-width:240px;
}
.line-color-trigger{
  width:28px; height:28px; border-radius:50%;
  border:2px solid #9ca3af; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,.1);
  transition: transform .15s;
}
.line-color-trigger:hover{ transform: scale(1.1); }
.line-controls-col{ text-align:center; }
.line-controls-col label{ font-size:13px; font-weight:700; margin-bottom:8px; display:block; color:#374151; }
.apply-all-btn{
  width:32px; height:32px; padding:0; border-radius:8px;
  background:#fff; border:1px solid #d1d5db; color: #6b7280;
  cursor:pointer; display:grid; place-items:center; transition: .2s;
}
.apply-all-btn:hover{ border-color: #9ca3af; background: #f9fafb; }
.apply-all-btn.active{ background: #eaf1ff; border-color: #0f62fe; color: #0f62fe; }

/* Слайдеры */
.thickness-slider{
  appearance:none; width:120px; height:8px; border-radius:999px;
  background:linear-gradient(90deg, var(--brand) 0%, var(--brand) 0%, #e5e7eb 0%); outline:none;
}
.thickness-slider::-webkit-slider-thumb{
  appearance:none; width:20px; height:20px; border-radius:50%; background:var(--brand);
  box-shadow:0 3px 8px rgba(0,0,0,.2); cursor:pointer; transition:transform .15s;
}
.thickness-slider::-webkit-slider-thumb:hover{ transform:scale(1.1); }
#thickness-value{ font-variant-numeric: tabular-nums; }

/* Фон */
.gradient-selector{
  display:grid; grid-template-columns: repeat(3, 45px); gap:8px;
  background:#fff; padding:10px 12px; border-radius:12px; box-shadow: var(--shadow); justify-items:center; align-items:center;
}
.gradient-title{ grid-column:1/-1; font-size:13px; font-weight:700; margin-bottom:2px; color:#374151; }
.grad-btn{
  width:36px; height:36px; border-radius:10px; border:1px solid #e5e7eb;
  cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.06); transition:transform .15s; background:#fff;
}
.grad-btn:hover{ transform:translateY(-1px); }

/* Canvas/SVG */
#canvas{ position:relative; width:100%; height:100%; transform-origin:0 0; cursor:default; }
#svg-layer{ position:absolute; inset:0; pointer-events:none; overflow:visible; }
.line{
  fill:none; pointer-events:auto; cursor:pointer;
  color: var(--line-color, var(--brand));
  filter: drop-shadow(0 0 5px rgba(0,0,0,.15));
  marker-start: url(#marker-dot);
  marker-end: url(#marker-dot);
}
.line.selected{ stroke-dasharray:6 6; }

/* Карточка */
.card{
  position:absolute; width:var(--card-width);
  background: var(--surface); border-radius:16px; box-shadow: var(--shadow);
  transition: transform .15s ease, box-shadow .15s ease;
}
.card:hover{ transform:translateY(-1px); box-shadow:0 12px 26px rgba(0,0,0,.18); }
.card.selected{ 
  box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.6), 0 12px 26px rgba(0,0,0,.18);
}

/* Заголовок карточки */
.card-header{
  background: var(--brand); color:#fff; padding:10px; position:relative;
  height:52px; border-radius:16px 16px 0 0; cursor:grab;
  display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:6px;
}
.card-title{
  grid-column:2/3; text-align:center; font-size:20px; line-height:1; font-weight:800; letter-spacing:.3px; outline:none;
}
.close-btn{ grid-column:3/4; justify-self:end; font-size:20px; cursor:pointer; transition:transform .15s; padding: 0 5px;}
.close-btn:hover{ transform:scale(1.1) rotate(8deg); }

/* Кнопка цвета шапки */
.header-color-picker-btn{
  position:absolute; top:80px; left:10px; z-index:10; width:22px; height:22px; border-radius:6px;
  border:2px solid #444; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,.1);
}
.header-color-picker-btn:hover{ transform:scale(1.05); }

.color-changer {
  border: 2px solid #444;
  position: absolute;
  top: 110px;
  left: 10px;
  z-index: 10;
}

/* Тело карточки */
.card-body{ padding:15px; text-align:center; background:#fff; border-radius:0 0 16px 16px; }
.card-body.dark-bg{ background:#2b2b2b; }

.card-row{ display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:12px; }
.label{ font-weight:700; color:#374151; }
.value{
  color:#111827; font-weight:800; font-size:20px; outline:none; padding:3px 6px; border-radius:5px;
}
.value:focus{ background:#fff8dc; box-shadow:0 0 6px 2px rgba(255,193,7,.35); }

/* Монетка */
.coin-icon{ width:28px; height:28px; cursor:pointer; transition:transform .15s; }
.coin-icon:hover{ transform:scale(1.1); }

/* Точки соединения */
.connection-point{
  position:absolute; width:16px; height:16px; z-index:101;
  background:#fff; border:3px solid var(--brand); border-radius:50%;
  cursor:pointer; transform:translate(-50%,-50%); display:none; transition: background .15s, transform .15s;
}
.card:hover .connection-point{ display:block; }
.connection-point:hover{ background: var(--brand); transform: scale(1.15) translate(-50%,-50%); }
.connection-point.top{ top:0; left:50%; }
.connection-point.bottom{ top:100%; left:50%; }
.connection-point.left{ top:50%; left:0; }
.connection-point.right{ top:50%; left:100%; }

/* Низ карточки */
.card-controls{ position:absolute; bottom:8px; right:8px; display:flex; gap:6px; z-index:102; }
.card-control-btn{
  width:22px; height:22px; border:none; border-radius:6px; cursor:pointer;
  box-shadow:0 2px 5px rgba(0,0,0,.1); font-size:16px; display:grid; place-items:center;
}
.body-color-changer{ position:absolute; bottom:8px; left:8px; }

/* === Стили для заметок === */
.note-btn { background:#fff; }
.note-btn.has-text { background:#e11d48; color:#fff; }
.note-window{
  position:fixed; width:260px; min-height:380px;
  background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow: var(--shadow);
  z-index:1500; 
  display:flex; flex-direction:column;
  resize:both; 
  overflow:hidden;
}
.note-header{ 
  background:#f3f4f6; padding:6px 8px; border-radius:12px 12px 0 0; cursor:grab;
  display:flex; align-items:center; justify-content:space-between;
  flex-shrink: 0;
}
.note-content-scroller { flex-grow: 1; overflow-y: auto; }
.note-textarea{
  display: block; width: calc(100% - 16px); box-sizing: border-box;
  border:1px solid #e5e7eb; background:#ffffff; color:#222; border-radius:8px; margin:8px; padding:10px;
  font-family:inherit; font-size:14px; line-height:1.35; 
  resize:vertical; outline:none; min-height:120px;
}
.note-resize-handle{ 
  position:absolute; bottom:0; right:0; width:15px; height:15px; cursor:se-resize; z-index: 1;
  background:repeating-linear-gradient(135deg,#ccc,#ccc 2px,transparent 2px,transparent 4px); 
}
.notes-dropdown{
  position:fixed; z-index:3000; display:none; max-height:320px; overflow:auto;
  min-width:280px; max-width:380px; padding:6px;
  background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow: var(--shadow);
}
.note-item{ display:flex; gap:10px; padding:8px; border-radius:10px; align-items:flex-start; justify-content:space-between; }
.note-item:hover{ background:#f3f4f6; }
.note-item-content{ display:flex; gap:10px; align-items:flex-start; cursor:pointer; flex-grow:1; }
.note-dot{ width:10px; height:10px; border-radius:50%; border:2px solid #111; margin-top:6px; flex-shrink:0; }
.note-meta{ display:flex; flex-direction:column; gap:2px; }
.note-date{ font-weight:700; }
.note-text-preview{ font-size:13px; color:var(--muted); word-break: break-word; }
.note-delete-btn{
  font-size:20px; color:#9ca3af; cursor:pointer; padding:0 4px; border-radius:50%;
  transition: color .2s, background-color .2s; flex-shrink:0; align-self:center; border: none; background: transparent;
}
.note-delete-btn:hover{ color:#ef4444; background-color:#fee2e2; }
.note-window .cal-grid{ width:100%; display:grid; grid-template-columns:repeat(7,1fr); grid-auto-rows:26px; }
.note-window .cal-cell{ min-width:0; height:26px; line-height:26px; padding:0; overflow:hidden; white-space:nowrap; text-overflow:clip; }
.note-window .cal-month{ white-space:nowrap; }

.selection-box{
  position:absolute; border:2px dashed #0f62fe; background:rgba(15,98,254,.08); pointer-events:none;
}

/* --- Стили для значков, контекстного меню и темной темы --- */
.slf-badge, .fendou-badge, .rank-badge {
  position: absolute;
  display: none;
  user-select: none;
  pointer-events: none; /* Чтобы не мешали кликам */
}
.slf-badge.visible, .fendou-badge.visible, .rank-badge.visible {
  display: block;
}
.slf-badge {
  top: 15px;
  left: 15px;
  color: #ffc700;
  font-weight: 900;
  font-size: 24px;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}
.fendou-badge {
  top: -25px;
  left: 50%;
  transform: translateX(-50%);
  color: red;
  font-weight: 900;
  font-size: 36px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}
.rank-badge {
  top: -15px;
  right: 15px;
  width: 80px;
  height: auto;
  transform: rotate(15deg);
}

.card-context-menu {
  position: fixed;
  z-index: 10000;
  display: none;
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  padding: 5px 0;
  min-width: 180px;
}
.context-menu-section {
  border-bottom: 1px solid #eee;
  padding: 5px 0;
}
.context-menu-section:last-child {
  border-bottom: none;
  padding-bottom: 0;
}
.context-menu-section:first-child {
  padding-top: 0;
}
.context-menu-item {
  padding: 8px 15px;
  cursor: pointer;
  font-size: 14px;
}
.context-menu-item:hover {
  background-color: #f0f0f0;
}
.context-menu-item.active {
  background-color: #e0eafc;
  font-weight: bold;
}

.card.dark-mode,
.card.dark-mode .card-body{ background:#2b2b2b; }
.card.dark-mode .label{ color:#e5e7eb; }
.card.dark-mode .value{ color:#f9fafb; }
.card.dark-mode .card-header{ background:#1f2937 !important; }
.card.dark-mode .card-title{ color:#f3f4f6; }
.card.dark-mode .note-btn,
.card.dark-mode .color-changer{ background:#374151 !important; border-color:#4b5563; color:#e5e7eb; }

.card.dark-mode .header-color-picker-btn,
.card.dark-mode .color-changer {
  visibility: hidden;
}
.card.dark-mode .coin-icon {
  visibility: hidden;
}

.content-hidden .slf-badge,
.content-hidden .fendou-badge,
.content-hidden .rank-badge {
  visibility: hidden !important;
}

.num-color-pop{
  position:fixed; z-index:3000; display:none; background:#fff; border:1px solid #e5e7eb; border-radius:10px;
  box-shadow: var(--shadow); padding:6px; gap:6px; align-items:center;
}
.num-color-pop .dot{ width:18px; height:18px; border-radius:50%; border:2px solid #333; cursor:pointer; }
.num-color-pop .dot.red{ background:#e53935; }
.num-color-pop .dot.yellow{ background:#ffeb3b; }
.num-color-pop .dot.green{ background:#43a047; }
.value [data-num-color]{ color: initial; }

.active-pv-controls{display:flex;justify-content:space-between;gap:8px;margin-top:4px}
.active-pv-controls .left-controls,
.active-pv-controls .right-controls{display:flex;gap:6px}
.active-pv-controls .mid-controls{display:flex;align-items:center}
.active-btn{font-size:12px;padding:2px 6px;border-radius:8px;border:1px solid rgba(0,0,0,.12);background:#f5f5f7;cursor:pointer}
.card.dark-mode .active-btn{background:#2b2b2f;border-color:#3a3a40}
.active-btn:hover{filter:brightness(.96)}
.card .active-pv-row .value{pointer-events:none; user-select:none;}

.guide-line {
  position: fixed;
  background-color: rgba(255, 0, 0, 0.7);
  z-index: 9998;
  display: none;
  pointer-events: none;
  box-shadow: 0 0 3px rgba(0,0,0,0.5);
}
.guide-line.vertical {
  width: 1px;
  height: 100vh;
  top: 0;
}
.guide-line.horizontal {
  height: 1px;
  width: 100vw;
  left: 0;
}
#toggle-guides-btn.active {
    background-color: #eaf1ff;
    color: #0f62fe;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);

}
/* === Стили для модального окна печати (ИСПРАВЛЕННАЯ ВЕРСИЯ) === */
.print-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.print-modal-content {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  width: 90vw;
  max-width: 800px;
  display: flex;
  flex-direction: column;
}

.print-modal-header {
  padding: 15px 25px;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.print-modal-header h2 {
  margin: 0;
  font-size: 22px;
}
.print-modal-close-btn {
  border: none;
  background: none;
  font-size: 32px;
  cursor: pointer;
  color: #9ca3af;
  line-height: 1;
}
.print-modal-close-btn:hover {
  color: #111827;
}

.print-modal-body {
  display: flex;
  padding: 20px 25px;
  gap: 25px;
  min-height: 500px;
}

.print-controls {
  flex: 0 0 300px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.print-control-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.print-control-group label {
  font-weight: 700;
  color: #374151;
}
.print-control-group select,
.print-control-group input[type="text"] {
  width: 100%;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-size: 14px;
}
.print-control-group .checkbox-label {
  display: flex;
  align-items: center;
  cursor: pointer;
}
.print-control-group input[type="checkbox"] {
  margin-right: 8px;
}
.orientation-buttons {
  display: flex;
  gap: 10px;
}
.orientation-btn {
  flex: 1;
  height: 40px;
  border: 2px solid #d1d5db;
  border-radius: 8px;
  background: #fff;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #6b7280;
}
.orientation-btn.active {
  border-color: #0f62fe;
  background-color: #eaf1ff;
  color: #0f62fe;
}

.print-actions {
  margin-top: auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.print-action-btn {
  padding: 12px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  background-color: #0f62fe;
  color: white;
}
.print-action-btn:hover:not(:disabled) {
  background-color: #0042d6;
}
.print-action-btn:disabled {
  background-color: #9ca3af;
  cursor: not-allowed;
}

.print-preview-container {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: #f3f4f6;
  border-radius: 12px;
  padding: 15px;
  min-width: 0;
}
#print-preview-area {
  box-shadow: 0 4px 15px rgba(0,0,0,0.15);
  background: #fff;
  overflow: hidden;
  position: relative;
}
#print-preview-area #canvas-clone-preview {
  position: absolute;
  top:0; left:0;
  transform-origin: top left;
}
#print-preview-area .card {
    box-shadow: none;
    border: 1px solid #e5e7eb;
}
#print-status-label {
    margin-top: 15px;
    font-weight: 500;
    color: #374151;
    min-height: 20px;
}

/* Улучшенные стили для режимов печати */
.content-hidden .card-title,
.content-hidden .value,
.content-hidden .coin-icon,
.content-hidden .active-pv-controls {
    visibility: hidden !important;
}
.outline-mode .card-header,
.outline-mode .card-body,
.outline-mode .card,
.outline-mode .card.dark-mode,
.outline-mode .card.dark-mode .card-body {
    background: none !important;
}
.outline-mode .card {
    border: 1px solid #000 !important;
}
.outline-mode .card-header {
    border-bottom: 1px solid #000 !important;
}
.outline-mode .value, .outline-mode .label, .outline-mode .card-title,
.outline-mode .card.dark-mode .value,
.outline-mode .card.dark-mode .label,
.outline-mode .card.dark-mode .card-title {
    color: #000 !important;
}
.outline-mode .line {
    color: #000 !important;
    stroke: #000 !important;
    filter: none !important;
}
.outline-mode .coin-icon circle {
    fill: none !important;
    stroke: #000 !important;
}
.outline-mode .fendou-badge, .outline-mode .slf-badge {
    color: #000 !important;
    text-shadow: none !important;
}
.outline-mode .rank-badge {
    opacity: 0.6;
    filter: grayscale(1);
}

